import{D as q,s as K,r as u,c as Q,b as A,o as X,d as h,f as P,g as k,j as s,t as d,h as i,i as C,k as Y,l as y,F as Z,n as ee,J as te,T as se,H as oe,E as l,p as ae}from"./index.25c5763d.js";import{u as ne}from"./userStore.df57d0cc.js";import{e as le,b as re,a as ie}from"./group.e63d0de3.js";import{d as ce,u as ue}from"./upload.bc07a7ff.js";import de from"./PopWinFriendList.8128924f.js";import{_ as ge}from"./_plugin-vue_export-helper.cdc0426e.js";import"./friendStore.3d0886d6.js";import"./friend.2ac2f8da.js";/* empty css                                                                    */import"./ResultItem.b7781963.js";/* empty css                                                                   */import"./newStore.3d7b1572.js";const pe={class:"all flex"},me={class:"avatar-and-members flex"},he={class:"avatar flex"},fe={class:"this-font"},ve={class:"g-avatar"},_e={class:"add-btn"},we={class:"el-upload__tip"},be={class:"member flex"},Ce={class:"this-font"},ye={class:"scroll-bar flex"},xe=["onClick"],Se=["src"],Ie={class:"memberName"},Ne={class:"changeable"},Ee={class:"item flex i1"},Fe={class:"change flex"},Ge={class:"this-font"},Ae={class:"item flex i2"},Pe={class:"change flex"},ke={class:"this-font"},De=q({__name:"GroupChatSetting",setup(Ve){const g=ne(),{token:x}=K(g),S=u(g.getGroupId),I=u(g.getGroupName),N=u(g.getNotice),p=u(g.getGroupAvatar),{t:r}=Q();u(0);const v=A([]),E=A([]);var _=u("circle");const F=u(!1),w=u();let f=A([]);function V(){F.value=!0}function L(){F.value=!1}const M=e=>{w.value.clearFiles();const t=e[0];t.uid=oe(),w.value.handleStart(t)};function $(e,t){let o=new FileReader;o.readAsDataURL(e.raw),o.onload=a=>{f.push({name:e.raw.name,url:a.target.result})},f.push(e.raw),U()}function B(e){return new Promise((t,o)=>{setTimeout(()=>{e=="https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png"&&t("No need to delete"),e.startsWith("https://s1.ax1x.com")||t("Cannot Delete");let a=e.lastIndexOf("/")+1,n=e.lastIndexOf("."),b=e.substring(a,n);ce(b).then(m=>{m.data.success?(l({type:"success",message:r("chatInputBox.deletePicSuccess"),showClose:!0,grouping:!0}),t("Delete Success")):(l({type:"error",message:m.data.msg,showClose:!0,grouping:!0}),t("Delete Fail"))}).catch(m=>{l({type:"error",message:r("chatInputBox.deletePicError"),showClose:!0,grouping:!0}),console.log(m),t("Delete Error")})},500)})}function T(){return new Promise((e,t)=>{setTimeout(()=>{let o=new FormData,a=f;for(let n=0;n<a.length;n++)o.append("file",a[n]);ue(o,2).then(n=>{n.data.success?(p.value=n.data.data,e("Upload New Avatar Success!")):l({type:"error",message:n.data.msg,showClose:!0,grouping:!0})}).catch(n=>{l({type:"error",message:r("chatInputBox.uploadPicError"),showClose:!0,grouping:!0}),console.log(n)})},500)})}async function U(){await B(p.value),await T(),f.length=0,w.value.clearFiles(),g.groupAvatar=p.value,W()}function z(){le(x.value,S.value).then(e=>{if(e.data.success){v.push(...e.data.data);for(let t=0;t<v.length;t++)E.push(v[t])}else l({type:"error",message:e.data.msg,showClose:!0,grouping:!0})}).catch(e=>{l({type:"error",message:r("groupSetting.getMemberError"),showClose:!0,grouping:!0})})}function R(){G(r("groupSetting.changeName"),r("groupSetting.changeNameError"))}function j(){G(r("groupSetting.changeNotice"),r("groupSetting.changeNoticeError"))}function W(){G(r("groupSetting.changeAvatar"),r("groupSetting.changeAvatarError"))}function G(e,t){const o={id:S.value,name:I.value,avatar:p.value,notice:N.value};re(x.value,o).then(a=>{a.data.success?l({type:"success",message:e,showClose:!0,grouping:!0}):l({type:"error",message:a.data.msg,showClose:!0,grouping:!0})}).catch(a=>{l({type:"error",message:t,showClose:!0,grouping:!0}),console.log(a)})}function O(){_.value=_.value=="circle"?"del-circle circle":"circle"}function H(e){_.value!="circle"}function J(e){E.push(e);let t={groupId:S.value,receiverId:e.id,message:""};ie(x.value,t).then(o=>{o.data.success||l({type:"error",message:o.data.msg,showClose:!0,grouping:!0})}).catch(o=>{l({type:"error",message:r("createGroup.inviteError"),showClose:!0,grouping:!0}),console.log(o)})}return X(()=>{z()}),(e,t)=>{const o=h("el-image"),a=h("el-button"),n=h("el-upload"),b=h("el-avatar"),m=h("el-scrollbar"),D=h("el-input");return P(),k("div",pe,[s("div",me,[s("div",he,[s("div",fe,d(e.$t("groupSetting.groupAvatar")),1),s("div",ve,[i(o,{class:"g-avatar",src:p.value,"preview-src-list":[p.value],fit:"cover"},null,8,["src","preview-src-list"])]),s("div",_e,[i(n,{ref_key:"uploadRef",ref:w,"on-change":$,"on-exceed":M,class:"upload-demo",accept:"image/jpeg,image/png,image/jpg",action:"#","file-list":y(f),limit:1,"auto-upload":!1,"show-file-list":!1},{trigger:C(()=>[i(a,{type:"primary",round:"",class:"",style:{"margin-top":"1vh"}},{default:C(()=>[Y(d(e.$t("groupSetting.addAvatar")),1)]),_:1})]),tip:C(()=>[s("div",we,d(e.$t("buttons.picInfo")),1)]),_:1},8,["file-list"])])]),s("div",be,[s("div",Ce,d(e.$t("groupSetting.groupMember")),1),i(m,{"wrap-class":"member-scroll-bar",class:"scroll"},{default:C(()=>[s("div",ye,[(P(!0),k(Z,null,ee(v,c=>(P(),k("div",{key:c.id,class:"scroll-item"},[s("div",{class:ae(y(_)),onClick:Le=>H(c.id)},[s("img",{src:c.avatar,class:"imgClass"},null,8,Se)],10,xe),s("div",Ie,d(c.uname),1)]))),128)),s("div",null,[i(b,{size:100,icon:y(te),onClick:V,class:"scroll-item oper"},null,8,["icon"])]),s("div",null,[i(b,{size:100,icon:y(se),onClick:O,class:"scroll-item oper",style:{display:"none"}},null,8,["icon"])])])]),_:1})])]),s("div",Ne,[s("div",Ee,[s("div",Fe,[s("div",Ge,d(e.$t("groupSetting.groupName")),1),i(D,{modelValue:I.value,"onUpdate:modelValue":t[0]||(t[0]=c=>I.value=c),class:"text name-bar",maxlength:20,minlength:1,"show-word-limit":"",size:"large",onChange:R},null,8,["modelValue"])])]),s("div",Ae,[s("div",Pe,[s("div",ke,d(e.$t("groupSetting.importantNotice")),1),i(D,{modelValue:N.value,"onUpdate:modelValue":t[1]||(t[1]=c=>N.value=c),rows:4,resize:"none",type:"textarea",maxlength:200,minlength:1,"show-word-limit":"",class:"text notice-bar",onChange:j},null,8,["modelValue"])])])]),i(de,{"dialog-visible":F.value,list:E,onCloseWin:L,onAddFun:J},null,8,["dialog-visible","list"])])}}});const qe=ge(De,[["__scopeId","data-v-5d4cbfdc"]]);export{qe as default};
