import{a as H,L as K,d as _,f as m,g,j as o,h as u,t as I,M as V,D as te,c as q,r as p,b as E,m as Y,I as se,N as ae,l as A,i as N,k as oe,E as w,u as ne,s as re,o as le,O as ie,P as ce,w as ue,e as de,F as pe,n as me}from"./index.25c5763d.js";import{r as z,u as ge}from"./userStore.df57d0cc.js";/* empty css                                                                 */import{_ as F}from"./_plugin-vue_export-helper.cdc0426e.js";import{u as he}from"./upload.bc07a7ff.js";import{f as ve}from"./time.1971aa2a.js";const fe={id:"all"},_e={key:0,class:"bubble right"},ye={class:"avatar"},we={class:"wrap w1"},Ce={class:"content"},Me={key:0,class:"text"},xe={key:1},Se={class:"sender"},be={key:1,class:"bubble left"},ke={class:"avatar"},$e={class:"sender"},Ie={class:"wrap w2"},Ne={class:"content"},Re={key:0,class:"text"},Te={key:1},De={class:"sender"},ze={__name:"ChatMessage",props:{avatar:String,name:String,message:String,time:String,isMe:Boolean,isGroup:Boolean,type:String,id:String,uid:String},setup(l){const t=l,c=H(),n=K();function x(){if(!t.isGroup){var v=String(n.params.id).substr(1);c.push({name:"friendInfo",params:{id:v}})}}return(v,S)=>{const h=_("el-avatar"),b=_("el-image");return m(),g("div",fe,[l.isMe?(m(),g("div",_e,[o("div",null,[o("div",ye,[u(h,{src:t.avatar},null,8,["src"])])]),o("div",we,[o("div",Ce,[t.type=="text"?(m(),g("div",Me,I(t.message),1)):t.type=="img"||t.type=="picture"?(m(),g("div",xe,[u(b,{class:"img",src:t.message,"z-index":100,"preview-teleported":"","preview-src-list":[t.message]},null,8,["src","preview-src-list"])])):V("",!0)]),o("div",null,[o("div",Se,I(l.time),1)])])])):(m(),g("div",be,[o("div",{onClick:x},[o("div",ke,[u(h,{src:l.avatar,onClick:x},null,8,["src"]),o("div",$e,I(l.name),1)])]),o("div",Ie,[o("div",Ne,[t.type=="text"?(m(),g("div",Re,I(t.message),1)):t.type=="img"||t.type=="picture"?(m(),g("div",Te,[u(b,{class:"img",src:t.message,"z-index":100,"preview-teleported":"","preview-src-list":[t.message]},null,8,["src","preview-src-list"])])):V("",!0)]),o("div",null,[o("div",De,I(l.time),1)])])]))])}}},Ae=F(ze,[["__scopeId","data-v-0f6ff48c"]]);function Be(l,t,c){return z({headers:{Authorization:l},url:`/chat/history/friend/${t}`,method:"post",data:{pageNum:c.pageNum,pageSize:c.pageSize}})}function Ee(l,t,c){return z({headers:{Authorization:l},url:`/chat/history/group/${t}`,method:"post",data:{pageNum:c.pageNum,pageSize:c.pageSize}})}function Fe(l,t){return z({headers:{Authorization:l},url:"/chat/send",method:"post",data:{chatId:t.chatId,type:"friend",msg:t.msg,msgType:t.msgType}})}function Pe(l,t){return z({headers:{Authorization:l},url:"/chat/send",method:"post",data:{chatId:t.chatId,type:"group",msg:t.msg,msgType:t.msgType}})}function Le(l,t,c){return z({headers:{Authorization:l},url:`/chat/leaveRoom/${t}/${c}`,method:"put"})}const je={class:"all"},Ge={id:"left"},Ue=["onKeydown","placeholder"],Ve={id:"right"},He={class:"top"},Ke={class:"bottom"},qe=te({__name:"ChatInputBox",emits:["addPic","sendMsg"],setup(l,{emit:t}){const{t:c}=q(),n=p(""),x=p();p(!1),p("https://fuss10.elemecdn.com/3/63/4e7f3a15429bfda99bce42a18cdd1jpeg.jpeg?imageMogr2/thumbnail/360x360/format/webp/quality/100");let v=E([]),S;async function h(a,d){let r=new FileReader;r.readAsDataURL(a.raw),r.onload=M=>{v.push({name:a.raw.name,url:M.target.result})},v.push(a.raw),C()}function b(){n.value=""}function R(){n.value=n.value.trim(),n.value.length!=0&&(t("sendMsg",n.value,"text"),b())}function B(a){a.ctrlKey&&a.keyCode==13&&R()}function C(){let a=new FormData,d=v;for(let r=0;r<d.length;r++)a.append("file",d[r]);he(a,3).then(r=>{r.data.success?(S=r.data.data,console.log("picSet: "+S),t("addPic",S),v.length=0,x.value.clearFiles()):w({type:"error",message:r.data.msg,showClose:!0,grouping:!0})}).catch(r=>{w({type:"error",message:c("chatInputBox.uploadPicError"),showClose:!0,grouping:!0}),console.log(r)})}return(a,d)=>{const r=_("Picture"),M=_("el-icon"),T=_("el-upload"),D=_("el-button");return m(),g("div",je,[o("div",Ge,[Y(o("textarea",{onKeydown:ae(B,["enter"]),rows:"6","onUpdate:modelValue":d[0]||(d[0]=k=>n.value=k),style:{outline:"none",color:"black"},placeholder:A(c)("chatInputBox.chat")},null,40,Ue),[[se,n.value]])]),o("div",Ve,[o("div",He,[o("div",null,[u(T,{ref_key:"uploadRef",ref:x,limit:1,action:"#",accept:"image/png,image/gif,image/jpg,image/jpeg","file-list":A(v),class:"upload-demo","on-change":h,"auto-upload":!1},{trigger:N(()=>[u(M,{class:"addp",size:25},{default:N(()=>[u(r)]),_:1})]),_:1},8,["file-list"])])]),o("div",Ke,[u(D,{round:"",type:"primary",onClick:R},{default:N(()=>[oe(I(a.$t("chatInputBox.send")),1)]),_:1})])])])}}}),Ye=F(qe,[["__scopeId","data-v-aeff4635"]]),Oe={class:"all flex"},Je={class:"inner-all"},Qe={class:"infinite-list"},We={class:"input-box"},Xe={__name:"ChatRoom",emits:["wSend"],setup(l,{expose:t,emit:c}){ne(e=>({"52d511f3":T.value,"07cd2c9f":D.value}));const{t:n}=q(),x=K(),v=H(),S=ge(),{token:h,avatar:b,name:R,getNewMsg:B}=re(S);p(0);const C=E([]),a=p(!1),d=p(""),r=p(!1),M=p(!1),T=p(""),D=p(""),k=E({pageNum:1,pageSize:10});var O=p("");function P(e){let s=new Date,i={msgId:"-1",senderId:e.sender,senderName:e.senderName,senderAvatar:e.senderAvatar,sentDate:{year:s.getFullYear(),month:s.getMonth()+1,day:s.getDate(),hour:s.getHours(),min:s.getMinutes()+1},isMe:!1,msg:e.msg,msgType:e.msgType};C.push(i)}function L(){if(!M.value&&!r.value){r.value=!0;let e;a.value?e=Ee(h.value,d.value,k):e=Be(h.value,d.value,k),e.then(s=>{s.data.success?s.data.data.length<=0?M.value=!0:(M.value=!1,C.unshift(...s.data.data.reverse()),k.pageNum+=1):w({type:"error",message:n("chatRoom.LoadError"),showClose:!0,grouping:!0})}).catch(s=>{a.value?n("chatRoom.friendLoadError"):n("chatRoom.groupLoadError"),w({type:"error",message:n("chatRoom.LoadError"),showClose:!0,grouping:!0}),console.log(s)}).finally(()=>{r.value=!1})}}function J(e,s){let i=a.value?"group":"friend",y={msg:e,msgType:s,sender:h.value,senderName:R.value,senderAvatar:b.value,receiver:d.value,receiverType:i};c("wSend",y)}function j(e,s){let i=new Date,y={msgId:"-1",senderId:"-1",senderName:R,senderAvatar:b,sentDate:{year:i.getFullYear(),month:i.getMonth()+1,day:i.getDate(),hour:i.getHours(),min:i.getMinutes()+1},isMe:!0,msg:e,msgType:s};C.push(y),J(e,s),Q(e,s)}function Q(e,s){let i={chatId:d.value,msg:e,msgType:s},y;a.value?y=Pe(h.value,i):y=Fe(h.value,i),y.then($=>{$.data.success||w({type:"error",message:$.data.msg,showClose:!0,grouping:!0})}).catch($=>{w({type:"error",message:n("chatRoom.sendError"),showClose:!0,grouping:!0}),console.log($)}).finally(()=>{})}function W(e){j(e,"img")}function G(){let e=x.params.id,s="";e[0]=="g"?(a.value=!0,T.value="flex",D.value="-webkit-flex"):e[0]=="f"?(a.value=!1,T.value="none",D.value="none"):w({type:"error",message:n("chatRoom.roomTypeError"),showClose:!0});for(let i=1;i<e.length;i++)s+=e[i];d.value=s.toString(),O.value=a.value?"Group ":"Friend ",M.value=!1,r.value=!1,k.pageNum=1,k.pageSize=10}function X(e){return S.name==e}function U(){Le(h.value,d.value,!a.value).then(e=>{e.data.success||w({type:"error",message:e.data.msg,showClose:!0,grouping:!0})}).catch(e=>{w({type:"error",message:n("chatRoom.leaveError"),showClose:!0,grouping:!0}),console.log(e)})}return le(()=>{G()}),ie(()=>{U(),G(),C.splice(0,C.length),L()}),ce(()=>{U()}),ue(B,e=>{e!=""&&P(e)}),t({receiveMsg:P}),(e,s)=>{const i=_("Star"),y=_("el-icon"),$=_("el-button"),Z=_("el-scrollbar"),ee=de("infinite-scroll");return m(),g("div",Oe,[o("div",Je,[u($,{class:"to-setting",onClick:s[0]||(s[0]=f=>A(v).push({name:"groupChatInfo",params:{}})),plain:""},{default:N(()=>[u(y,null,{default:N(()=>[u(i)]),_:1})]),_:1}),u(Z,{height:"55vh",id:"all",always:""},{default:N(()=>[Y((m(),g("ul",Qe,[(m(!0),g(pe,null,me(C,f=>(m(),g("li",{key:f.msgId},[u(Ae,{avatar:f.senderAvatar,name:f.senderName,message:f.msg,type:f.msgType,time:A(ve)(f.sentDate,!1),isMe:X(f.senderName),"is-group":a.value,id:f.msgId,uid:f.senderId},null,8,["avatar","name","message","type","time","isMe","is-group","id","uid"])]))),128))])),[[ee,L]])]),_:1})]),o("div",We,[u(Ye,{onAddPic:W,onSendMsg:j})])])}}},nt=F(Xe,[["__scopeId","data-v-3746acac"]]);export{nt as default};
