import{D as F,s as R,c as j,r as d,b as A,d as m,f as T,g as N,j as r,m as L,I as M,l as f,v as S,t as P,h as u,i as g,J as z,k as H,E as h}from"./index.25c5763d.js";import{u as J}from"./userStore.df57d0cc.js";import{p as q}from"./status.9e25c884.js";import{u as G}from"./upload.bc07a7ff.js";import{_ as K}from"./_plugin-vue_export-helper.cdc0426e.js";const O={class:"all"},Q={class:"mainpart"},W={class:"top"},X=["placeholder"],Y={class:"pics"},Z={class:"mid"},$={class:"bottom"},ee=F({__name:"PostStatus",setup(te){const x=J(),{token:C}=R(x),{t:c}=j();d(0);let t=A([]);const w=d();var _=[],i=d("");function V(e,o){let a=new FileReader;a.readAsDataURL(e.raw),a.onload=s=>{t.push({name:e.raw.name,url:s.target.result})},t.push(e.raw)}function b(){return new Promise((e,o)=>{setTimeout(()=>{console.log("length: "+t.length),console.log(t);let a=t;for(let s=0;s<a.length;s=s+2){let p=new FormData;p.append("file",a[s]),p.append("file",a[s+1]),G(p,0).then(l=>{l.data.success?(_.push(l.data.data),s+2>=a.length&&e("\u641E\u5B9A\uFF01")):h({type:"error",message:l.data.msg,showClose:!0,grouping:!0})}).catch(l=>{h({type:"error",message:c("chatInputBox.uploadPicError"),showClose:!0,grouping:!0}),console.log(l)})}},1e3)})}function k(){console.log(_),q(C.value,i.value,_).then(e=>{e.data.success?alert(c("postStatus.succeed")):h({type:"error",message:c("postStatus.err"),showClose:!0})}).catch(e=>{h({type:"error",message:c("postStatus.err"),showClose:!0}),console.log(e)}).finally(()=>{}),t.length=0,_.length=0,i.value="",w.value.clearFiles()}async function D(){await b(),k()}const y=d(""),v=d(!1),E=(e,o)=>{console.log(e,o)},I=e=>{y.value=e.url,v.value=!0},U=e=>{console.log(e)};return(e,o)=>{const a=m("el-icon"),s=m("el-upload"),p=m("el-image"),l=m("el-dialog"),B=m("el-button");return T(),N("div",O,[r("div",Q,[r("div",W,[L(r("textarea",{rows:"6","onUpdate:modelValue":o[0]||(o[0]=n=>S(i)?i.value=n:i=n),style:{"font-size":"16px",color:"red","font-family":"Arial","font-weight":"bold",outline:"none"},placeholder:f(c)("postStatus.placeHolder")},null,8,X),[[M,f(i)]])])]),r("div",Y,[r("div",Z,[r("span",null,P(e.$t("postStatus.putPic")),1)]),u(s,{"file-list":f(t),"onUpdate:file-list":o[1]||(o[1]=n=>S(t)?t.value=n:t=n),ref_key:"upload",ref:w,action:"#","list-type":"picture-card",accept:"image/png,image/gif,image/jpg,image/jpeg",mutiple:"","show-file-list":"","auto-upload":!1,"on-preview":I,"on-remove":E,"on-exceed":U,"on-change":V,limit:9},{default:g(()=>[u(a,null,{default:g(()=>[u(f(z))]),_:1})]),_:1},8,["file-list"]),u(l,{modelValue:v.value,"onUpdate:modelValue":o[2]||(o[2]=n=>v.value=n)},{default:g(()=>[u(p,{fit:"fill",src:y.value,alt:"Preview Image"},null,8,["src"])]),_:1},8,["modelValue"])]),r("div",$,[u(B,{round:"",type:"primary",id:"post-btn",onClick:D},{default:g(()=>[H(P(e.$t("postStatus.post")),1)]),_:1})])])}}});const re=K(ee,[["__scopeId","data-v-7e7c47ae"]]);export{re as default};
