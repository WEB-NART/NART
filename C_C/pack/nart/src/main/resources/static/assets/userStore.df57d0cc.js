import{A as d,B as h,E as s,C as o}from"./index.25c5763d.js";function u(){return localStorage.token}function n(t){return localStorage.token=t}function l(){return localStorage.removeItem("token")}const m="192.168.0.18:8888";d.defaults.withCredentials=!0;const i=d.create({baseURL:"http://"+m,timeout:1e4});function c(t,e){return i({method:"put",url:"/user/login",data:{uname:t,pwd:e}})}function p(t){return i({headers:{Authorization:t},url:"/user/logout",method:"put"})}function w(t,e,r){return i({method:"post",url:"/user/register",data:{uname:t,pwd:e,email:r}})}async function y(t,e){return i({headers:{Authorization:t},method:"get",url:`/user/info/${e}`})}function b(t,e){return i({headers:{Authorization:t},method:"put",url:"/user/changeInfo",data:{avatar:e.avatar,uname:e.uname,oldPwd:e.oldPwd,pwd:e.pwd,email:e.email,birthday:e.birthday,phone:e.phone,address:e.address}})}const v=h("user",{state:()=>({token:"",name:"",avatar:"",email:"",tel:"",address:"",birthday:"",groupId:"",notice:"",groupName:"",groupAvatar:""}),getters:{getGroupId:t=>t.groupId,getNotice:t=>t.notice,getGroupName:t=>t.groupName,getGroupAvatar:t=>t.groupAvatar},actions:{updategroupInfo(t){t!=null&&t!={}&&(t.gid!=null&&t.gid!=""&&(this.groupId=t.gid),t.notice!=null&&t.notice!=""&&(this.notice=t.note),t.gName!=null&&t.gName!=""&&(this.groupName=t.gName),t.gAvatar!=null&&t.gAvatar!=""&&(this.groupAvatar=t.gAvatar))},login(t){return new Promise((e,r)=>{c(t.username,t.password).then(a=>{if(a.data.success){n(a.data.data),this.token=u();let g=this.getUserInfo();e(g)}else s({type:"error",message:a.data.msg,showClose:!0,grouping:!0}),r(a.data.msg)}).catch(a=>{s({type:"error",message:o.global.t("user.loginError"),showClose:!0,grouping:!0}),r(a)})})},getUserInfo(){y(this.token,"-1").then(t=>{if(t.data.success)return console.log("getUserInfo success!"),this.name=t.data.data.uname,this.avatar=t.data.data.avatar,this.email=t.data.data.email,this.birthday=t.data.data.birthday,this.tel=t.data.data.phone,this.address=t.data.data.address,t.data.data.id;s({type:"error",message:t.data.msg,showClose:!0,grouping:!0})}).catch(t=>{s({type:"error",message:o.global.t("user.infoError"),showClose:!0,grouping:!0}),console.log(t)})},async changeUserInfo(t){return new Promise((e,r)=>{b(this.token,t).then(a=>{a.data.success?(this.name=t.uname,this.avatar=t.avatar,this.email=t.email,this.birthday=t.birthday,this.tel=t.phone,this.address=t.address,e(a.data)):(s({type:"error",message:a.data.msg,showClose:!0,grouping:!0}),e(a.data))}).catch(a=>{s({type:"error",message:o.global.t("user.changeInfoError"),showClose:!0,grouping:!0}),r(a)})})},logout(){return new Promise((t,e)=>{l(),p(this.token).then(r=>{r.data.success?(this.fedLogOut(),t()):(s({type:"error",message:r.data.msg,showClose:!0,grouping:!0}),t())}).catch(r=>{s({type:"error",message:o.global.t("user.logoutError"),showClose:!0,grouping:!0}),t(r)})})},fedLogOut(){return new Promise(t=>{this.name="",this.avatar="",this.email="",this.birthday="",this.tel="",this.address="",this.token="",t()}).catch(t=>{reject(t)})},register(t){return new Promise((e,r)=>{w(t.uname,t.pwd,t.email).then(a=>{a.data.success?(n(a.data.data),this.token=u(),this.getUserInfo(),e()):(s({type:"error",message:a.data.msg,showClose:!0,grouping:!0}),r(a.data.msg))}).catch(a=>{s({type:"error",message:o.global.t("user.registerError"),showClose:!0,grouping:!0}),r(a)})})}},persist:{enabled:!0}}),C=v;export{m as a,i as r,y as s,C as u};
