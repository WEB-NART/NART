import{D as J,r as v,a as K,s as Q,c as X,b as j,G as Y,d as u,f as F,g as x,h as r,i as c,j as n,t as d,l as E,k as N,F as Z,n as ee,H as te,E as l}from"./index.25c5763d.js";import{d as ae,u as oe}from"./upload.bc07a7ff.js";import{c as se,a as re,b as ne}from"./group.e63d0de3.js";import{u as le}from"./userStore.df57d0cc.js";import ce from"./PopWinFriendList.8128924f.js";import{_ as ie}from"./_plugin-vue_export-helper.cdc0426e.js";import"./friendStore.3d0886d6.js";import"./friend.2ac2f8da.js";/* empty css                                                                    */import"./ResultItem.b7781963.js";/* empty css                                                                   */import"./newStore.3d7b1572.js";const ue={class:"header h1"},de={class:"header-avatar"},pe={class:"header-edit"},ge={class:"text"},me={class:"el-upload__tip"},he={class:"header h2"},fe={class:"text header-label"},_e={class:"header-input"},ve={class:"scroll"},we={class:"scroll-bar"},ye={class:"memberName"},be={class:"main-btn"},Ce=J({__name:"createGroup",setup(Ie){const b=v(!1),P=le(),D=K(),{token:C}=Q(P),{t:i}=X(),m=v("https://fuss10.elemecdn.com/e/5d/4a731a90594a4af544c0c25941171jpeg.jpeg"),h=j([]),p=v(""),f=v(""),k=Y({get(){return i("createGroup.groupNameHolder")},set(e){}}),w=v();let _=j([]);var I=!1;const S=e=>{w.value.clearFiles();const t=e[0];t.uid=te(),w.value.handleStart(t)};function A(e,t){let a=new FileReader;a.readAsDataURL(e.raw),a.onload=o=>{_.push({name:e.raw.name,url:o.target.result})},_.push(e.raw),V()}function L(e){return new Promise((t,a)=>{setTimeout(()=>{e=="https://fuss10.elemecdn.com/e/5d/4a731a90594a4af544c0c25941171jpeg.jpeg"&&t("No need to delete"),e.startsWith("https://s1.ax1x.com")||t("Cannot Delete");let o=e.lastIndexOf("/")+1,s=e.lastIndexOf("."),G=e.substring(o,s);ae(G).then(g=>{g.data.success?(l({type:"success",message:i("chatInputBox.deletePicSuccess"),showClose:!0,grouping:!0}),t("Delete Success")):(l({type:"error",message:g.data.msg,showClose:!0,grouping:!0}),t("Delete Fail"))}).catch(g=>{l({type:"error",message:i("chatInputBox.deletePicError"),showClose:!0,grouping:!0}),console.log(g),t("Delete Error")})},500)})}function R(){return new Promise((e,t)=>{setTimeout(()=>{let a=new FormData,o=_;for(let s=0;s<o.length;s++)a.append("file",o[s]);oe(a,2).then(s=>{s.data.success?(m.value=s.data.data,e("Upload New Avatar Success!")):l({type:"error",message:s.data.msg,showClose:!0,grouping:!0})}).catch(s=>{l({type:"error",message:i("chatInputBox.uploadPicError"),showClose:!0,grouping:!0}),console.log(s)})},500)})}async function V(){await L(m.value),await R(),_.length=0,w.value.clearFiles()}function B(){return new Promise((e,t)=>{setTimeout(()=>{I=!1,se(C.value,f.value.trim()).then(a=>{a.data.success?(p.value=a.data.data,I=!0,e("got groupId")):l({type:"error",message:a.data.msg,showClose:!0,grouping:!0})}).catch(a=>{l({type:"error",message:i("createGroup.createError"),showClose:!0,grouping:!0}),console.log(a)})},500)})}function T(e){re(C.value,e).then(t=>{t.data.success||l({type:"error",message:t.data.msg,showClose:!0,grouping:!0})}).catch(t=>{l({type:"error",message:i("createGroup.inviteError"),showClose:!0,grouping:!0}),console.log(t)})}function $(e,t){const a={id:p.value,name:f.value.trim(),avatar:m.value,notice:""};ne(C.value,a).then(o=>{o.data.success?l({type:"success",message:e,showClose:!0,grouping:!0}):l({type:"error",message:o.data.msg,showClose:!0,grouping:!0})}).catch(o=>{l({type:"error",message:t,showClose:!0,grouping:!0}),console.log(o)})}async function U(){await B(),console.log(p.value),$(i("groupSetting.changeAvatar"),i("groupSetting.changeAvatarError"));for(let e=0;e<h.length;e++){let t={groupId:p.value,receiverId:h[e].id,message:""};T(t)}if(I){const e={gid:p.value,note:"",gName:f.value.trim(),gAvatar:m.value};P.updategroupInfo(e),D.push({name:"chatRoom",params:{id:"g"+p.value}})}}function W(e){h.push(e)}function z(){b.value=!0}function H(){b.value=!1}return(e,t)=>{const a=u("el-avatar"),o=u("el-button"),s=u("el-upload"),G=u("el-input"),g=u("el-header"),M=u("el-scrollbar"),O=u("el-main"),q=u("el-container");return F(),x("div",null,[r(q,null,{default:c(()=>[r(g,{class:"header hh"},{default:c(()=>[n("div",ue,[n("div",de,[r(a,{size:100,src:m.value},null,8,["src"])]),n("div",pe,[n("div",ge,d(e.$t("createGroup.avatarLabel")),1),r(s,{ref_key:"uploadRef",ref:w,"on-change":A,"on-exceed":S,class:"upload-demo",accept:"image/jpeg,image/png,image/jpg",action:"#","file-list":E(_),limit:1,"auto-upload":!1,"show-file-list":!1},{trigger:c(()=>[r(o,{type:"primary",round:"",class:"header-btn"},{default:c(()=>[N(d(e.$t("createGroup.addAvatar")),1)]),_:1})]),tip:c(()=>[n("div",me,d(e.$t("buttons.picInfo")),1)]),_:1},8,["file-list"])])]),n("div",he,[n("div",fe,d(e.$t("createGroup.groupName")),1),n("div",_e,[r(G,{modelValue:f.value,"onUpdate:modelValue":t[0]||(t[0]=y=>f.value=y),placeholder:E(k),size:"large"},null,8,["modelValue","placeholder"])])])]),_:1}),r(O,{class:"main"},{default:c(()=>[n("div",ve,[r(M,{class:"scroll-main-bar"},{default:c(()=>[n("div",we,[(F(!0),x(Z,null,ee(h,y=>(F(),x("div",{key:y.id,class:"scroll-item"},[r(a,{size:100,src:"https://cube.elemecdn.com/0/88/03b0d39583f48206768a7534e55bcpng.png"}),n("div",ye,d(y.name),1)]))),128))])]),_:1})]),n("div",be,[r(o,{type:"success",round:"",onClick:z},{default:c(()=>[N(d(e.$t("createGroup.addMember")),1)]),_:1}),r(o,{type:"primary",round:"",onClick:U},{default:c(()=>[N(d(e.$t("createGroup.create")),1)]),_:1})])]),_:1})]),_:1}),r(ce,{"dialog-visible":b.value,list:h,onCloseWin:H,onAddFun:W},null,8,["dialog-visible","list"])])}}});const Re=ie(Ce,[["__scopeId","data-v-ffd38d52"]]);export{Re as default};
