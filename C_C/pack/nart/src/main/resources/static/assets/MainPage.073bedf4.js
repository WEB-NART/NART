import{u as ie,a as fe}from"./userStore.df57d0cc.js";import{u as pe}from"./chatStore.6d9034ed.js";import{u as ge}from"./friendStore.3d0886d6.js";import{u as me,a as le,r as L,s as re,b as I,c as te,o as ce,w as _e,d as r,e as he,f as m,g as j,h as s,i as o,j as u,k as c,t as l,l as d,m as ve,F as we,n as ye,p as ke,q as y,v as ne,x as Ce,E as $,y as se,R as $e,z as Le}from"./index.25c5763d.js";import{s as Fe,h as be,m as Ne,u as Se,d as ze}from"./friend.2ac2f8da.js";import{s as Ee,h as Me,m as Ae,u as Ie,l as Pe}from"./group.e63d0de3.js";/* empty css                                                                    */import{_ as ue}from"./_plugin-vue_export-helper.cdc0426e.js";/* empty css                                                                       *//* empty css                                                                   *//* empty css                                                                   *//* empty css                                                                 *//* empty css                                                                     *//* empty css                                                                 */const Ve={class:"all"},Re={class:"dialog-footer"},xe={class:"main-scroll"},Be={class:"infinite-list"},Ge={style:{display:"flex","align-items":"center"}},Te={class:"colm"},De={style:{"z-index":"500"}},je={id:"bt"},He={__name:"ContactList",props:{isFriend:Boolean,showAll:Boolean,param:{page:{pageSize:Number,pageNum:Number}}},emits:["addPage"],setup(oe,{expose:w,emit:k}){const i=oe;me(e=>({ed104924:V.value,d9cda588:R.backgroundColor}));const E=le(),H=L(!1),P=L(!1),Q=ie(),{token:p}=re(Q),V=L("60px"),N="default";var _=I([]),g=I({});const C=L(!1),R=I({backgroundColor:"#fef0f0"}),{t:f}=te();function x(e){return e==2?"info":e==1?"success":e==0?"danger":"success"}function B(e){return!i.showAll&&e==1?"hide":"infinite-list-item"}function M(){!H.value&&!P&&G()}function G(){H.value=!0;let e,n={pageSize:i.param.page.pageSize,pageNum:i.param.page.pageNum};i.isFriend?e=Fe(p.value,n):e=Ee(p.value,n),e.then(t=>{t.data.success?t.data.data.length<=0?P.value=!0:(P.value=!1,_.push(...t.data.data),k("addPage",i.isFriend)):$({type:"error",message:t.data.msg,showClose:!0,grouping:!0})}).catch(t=>{i.isFriend?f("contactList.friend.ListError"):f("contactList.group.ListError"),$({type:"error",message:f("contactList.loadError"),showClose:!0,grouping:!0}),console.log(t)}).finally(()=>{H.value=!1})}function U(e){e.state=1,g={};let n;i.isFriend?n=be(p.value,e.id):n=Me(p.value,e.id),n.then(t=>{t.data.success?e.state=1:$({type:"error",message:t.data.msg,showClose:!0,grouping:!0})}).catch(t=>{i.isFriend?f("contactList.friend.hideError"):f("contactList.group.hideError"),$({type:"error",message:f("contactList.friend.hideError"),showClose:!0,grouping:!0}),console.log(t)}).finally(()=>{})}function W(e){e.state=2,g={};let n;i.isFriend?n=Ne(p.value,e.id):n=Ae(p.value,e.id),n.then(t=>{t.data.success?e.state=2:$({type:"error",message:t.data.msg,showClose:!0,grouping:!0})}).catch(t=>{i.isFriend?f("contactList.friend.muteError"):f("contactList.group.muteError"),$({type:"error",message:f("contactList.friend.muteError"),showClose:!0,grouping:!0}),console.log(t)}).finally(()=>{})}function q(e){e.state=0,g={};let n;i.isFriend?n=Se(p.value,e.id):n=Ie(p.value,e.id),n.then(t=>{t.data.success?e.state=0:$({type:"error",message:t.data.msg,showClose:!0,grouping:!0})}).catch(t=>{i.isFriend?f("contactList.friend.unsetError"):f("contactList.group.unsetError"),$({type:"error",message:f("contactList.friend.unsetError"),showClose:!0,grouping:!0}),console.log(t)}).finally(()=>{})}function J(e){C.value=!1;let n;i.isFriend?n=ze(p.value,e):n=Pe(p.value,e),n.then(t=>{if(t.data.success)for(var v=0;v<_.length;v++)_[v].id==e&&_.splice(v,1);else $({type:"error",message:t.data.msg,showClose:!0,grouping:!0})}).catch(t=>{i.isFriend?f("contactList.friend.delError"):f("contactList.group.delError"),$({type:"error",message:f("contactList.friend.delError"),showClose:!0,grouping:!0}),console.log(t)}).finally(()=>{})}function X(e){if(T(e.id,!1),i.isFriend)E.push({name:"chatRoom",params:{id:"f"+e.id}});else{const n={gid:e.id,note:e.notice,gName:e.name,gAvatar:e.avatar};Q.updategroupInfo(n),E.push({name:"chatRoom",params:{id:"g"+e.id}})}}const O=(e,n,t)=>{e?i.isFriend&&T(n,t):i.isFriend||T(n,t)};function T(e,n){for(let t=0;t<_.length;t++)_[t].id==e&&(_[t].newMsg=n)}function Y(e){return e=String(e),e.length>5?e.substring(0,4)+"...":e}return ce(()=>{i.isFriend?R.backgroundColor="#fef0f0":(R.backgroundColor="#faecd8",V.value="90px"),G()}),_e(()=>_.length,e=>{e<=i.param.page.pageSize&&M()}),w({noticeNewMsg:O}),(e,n)=>{const t=r("el-button"),v=r("el-dialog"),b=r("el-avatar"),S=r("el-badge"),h=r("el-button-group"),D=r("el-popover"),A=r("el-scrollbar"),K=he("infinite-scroll");return m(),j("div",Ve,[s(v,{modelValue:C.value,"onUpdate:modelValue":n[2]||(n[2]=a=>C.value=a),title:e.$t("contactList.friend.title"),width:"30%"},{footer:o(()=>[u("span",Re,[s(t,{onClick:n[0]||(n[0]=a=>C.value=!1)},{default:o(()=>[c(l(e.$t("buttons.cancel")),1)]),_:1}),s(t,{type:"primary",onClick:n[1]||(n[1]=a=>J(d(g).id))},{default:o(()=>[c(l(e.$t("buttons.confirm")),1)]),_:1})])]),default:o(()=>[u("span",null,l(e.$t("contactList.friend.del"))+l(d(g).name),1)]),_:1},8,["modelValue","title"]),u("div",xe,[s(A,{height:"77.5vh",id:"scroll-bar","wrap-style":"min-height:400px;"},{default:o(()=>[ve((m(),j("ul",Be,[(m(!0),j(we,null,ye(d(_),a=>(m(),j("li",{key:a.id,class:ke(B(a.state))},[u("div",Ge,[s(D,{placement:"right",width:30,trigger:"click"},{reference:o(()=>[u("div",Te,[s(S,{"is-dot":"",class:"item",hidden:!a.newMsg,type:x(a.state)},{default:o(()=>[i.isFriend?(m(),y(b,{key:0,src:a.avatar,onClick:F=>ne(g)?g.value=a:g=a},null,8,["src","onClick"])):(m(),y(b,{key:1,size:"large",src:a.avatar,onClick:F=>ne(g)?g.value=a:g=a},null,8,["src","onClick"]))]),_:2},1032,["hidden","type"])])]),default:o(()=>[u("div",De,[s(t,{class:"popLabel",text:"",onClick:F=>X(a)},{default:o(()=>[c(l(Y(a.name)),1)]),_:2},1032,["onClick"]),s(t,{type:"danger",icon:d(Ce),circle:"",class:"button",size:"small",id:"b1",onClick:n[3]||(n[3]=F=>C.value=!0)},null,8,["icon"]),u("div",je,[s(h,{size:"large"},{default:o(()=>[a.state==1?(m(),y(t,{key:0,class:"button",round:"",type:"primary",size:N,onClick:F=>q(a)},{default:o(()=>[c("\xA0"+l(e.$t("contactList.unset"))+"\xA0",1)]),_:2},1032,["onClick"])):(m(),y(t,{key:1,class:"button",round:"",type:"success",size:N,onClick:F=>U(a)},{default:o(()=>[c("\xA0"+l(e.$t("contactList.hide"))+"\xA0",1)]),_:2},1032,["onClick"])),a.state==2?(m(),y(t,{key:2,class:"button",round:"",type:"primary",size:N,onClick:F=>q(a)},{default:o(()=>[c("\xA0"+l(e.$t("contactList.unset"))+"\xA0",1)]),_:2},1032,["onClick"])):(m(),y(t,{key:3,class:"button",round:"",type:"info",size:N,onClick:F=>W(a)},{default:o(()=>[c("\xA0"+l(e.$t("contactList.mute"))+"\xA0",1)]),_:2},1032,["onClick"]))]),_:2},1024)])])]),_:2},1024)])],2))),128)),u("li",{onClick:G},"load more")])),[[K,M]])]),_:1})])])}}},ae=ue(He,[["__scopeId","data-v-f844a2e5"]]);const Ue={id:"overall"},We={class:"header-row"},qe={class:"col1"},Je={class:"col2"},Oe={class:"col3"},Ke={class:"el-dropdown-link"},Qe={class:"header-text t1"},Xe={class:"header-text t2"},Ye={class:"header-menu"},Ze={class:"aside-main"},et={class:"main-bar",id:"m1"},tt={class:"main-bar",id:"m2"},nt={__name:"MainPage",setup(oe){I(["https://cube.elemecdn.com/0/88/03b0d39583f48206768a7534e55bcpng.png","https://cube.elemecdn.com/0/88/03b0d39583f48206768a7534e55bcpng.png","https://cube.elemecdn.com/0/88/03b0d39583f48206768a7534e55bcpng.png","https://cube.elemecdn.com/0/88/03b0d39583f48206768a7534e55bcpng.png","https://cube.elemecdn.com/0/88/03b0d39583f48206768a7534e55bcpng.png"]);var w="";const k=le(),i=ie();pe();const E=ge(),{name:H,avatar:P,token:Q}=re(i);var p=L(""),V=I({page:{pageSize:10,pageNum:1}}),N=I({page:{pageSize:10,pageNum:1}}),_="zh",g=L(!1),C=L(!1);const{t:R}=te(),{locale:f}=te(),x=L(),B=L(),M=L();function G(){f.value=_,localStorage.setItem("lang",_),_=_=="en"?"zh":"en"}function U(){g.value=g.value!=!0}function W(){C.value=C.value!=!0}function q(){i.logout(),w="",k.push({name:"login"})}function J(){let e=p.value;e==""&&(e=""),E.fSearchHistory!=e&&(E.fSearchHistory=e,E.loadFirstList()),k.push({name:"searchFriend"})}function X(e){k.push({name:e})}function O(e){e?V.page.pageNum+=1:N.page.pageNum+=1}function T(){k.push({name:"editMyInfo"})}function Y(e){w.send(JSON.stringify(e))}return ce(()=>{w==""&&(w=new WebSocket("ws://"+fe+"/chat"),w.onopen=function(){console.log("ws open")},w.onclose=function(){console.log("ws close")},w.onmessage=function(e){var n=e.data,t=JSON.parse(n);let v=t.receiverType,b=t.receiver,S=t.sender;if(v=="friend"?x.value.noticeNewMsg(!0,S,!0):B.value.noticeNewMsg(!1,b,!0),k.currentRoute.value.name=="chatRoom"){let h=k.currentRoute.value.params.id,D=h[0],A=h.slice(1);D=="f"?S==A&&v=="friend"&&(x.value.noticeNewMsg(!0,S,!1),M.value.receiveMsg(t)):b==A&&v=="group"&&(B.value.noticeNewMsg(!1,b,!1),M.value.receiveMsg(t))}},console.log("ws set up!!"),console.log(w)),window.onbeforeunload=e=>{w="",i.logout().then(()=>"Close Notice")}}),(e,n)=>{const t=r("el-image"),v=r("el-input"),b=r("el-button"),S=r("el-avatar"),h=r("el-dropdown-item"),D=r("el-dropdown-menu"),A=r("el-dropdown"),K=r("el-header"),a=r("el-menu-item"),F=r("el-menu"),de=r("el-aside"),Z=r("el-main"),ee=r("el-container");return m(),j("div",Ue,[s(ee,null,{default:o(()=>[s(K,null,{default:o(()=>[u("div",We,[u("div",qe,[s(t,{src:"https://fuss10.elemecdn.com/e/5d/4a731a90594a4af544c0c25941171jpeg.jpeg",fit:"fill",style:{width:"220px",height:"50px","margin-left":"-6%"}})]),u("div",Je,[s(v,{modelValue:d(p),"onUpdate:modelValue":n[0]||(n[0]=z=>ne(p)?p.value=z:p=z),size:"large",class:"col2-input",placeholder:d(R)("findSthNew.placeholder"),onChange:J,"suffix-icon":d(se)},null,8,["modelValue","placeholder","suffix-icon"]),s(b,{icon:d(se),class:"col2-btn",onClick:J,circle:""},null,8,["icon"])]),u("div",Oe,[s(A,{trigger:"click"},{dropdown:o(()=>[s(D,null,{default:o(()=>[s(h,{onClick:n[1]||(n[1]=z=>G())},{default:o(()=>[c(l(e.$t("changeLang")),1)]),_:1}),s(h,{onClick:n[2]||(n[2]=z=>d(k).push({name:"postStatus",params:{}}))},{default:o(()=>[c(l(e.$t("main.menu.item1")),1)]),_:1}),s(h,{onClick:n[3]||(n[3]=z=>d(k).push({name:"myStatus"}))},{default:o(()=>[c(l(e.$t("main.menu.item2")),1)]),_:1}),d(g)?(m(),y(h,{key:0,onClick:U},{default:o(()=>[c(l(e.$t("main.menu.item3_hide")),1)]),_:1})):(m(),y(h,{key:1,onClick:U},{default:o(()=>[c(l(e.$t("main.menu.item3")),1)]),_:1})),d(C)?(m(),y(h,{key:2,onClick:W},{default:o(()=>[c(l(e.$t("main.menu.item4_hide")),1)]),_:1})):(m(),y(h,{key:3,onClick:W},{default:o(()=>[c(l(e.$t("main.menu.item4")),1)]),_:1})),s(h,{onClick:T},{default:o(()=>[c(l(e.$t("main.menu.item5")),1)]),_:1}),s(h,{onClick:q},{default:o(()=>[c(l(e.$t("main.menu.item6")),1)]),_:1})]),_:1})]),default:o(()=>[u("span",Ke,[s(S,{src:d(P),fit:"contain",style:{width:"50px",height:"50px"}},null,8,["src"])])]),_:1})])])]),_:1}),s(Z,{class:"first-main"},{default:o(()=>[s(ee,null,{default:o(()=>[s(K,{class:"header"},{default:o(()=>[u("div",Qe,l(e.$t("main.bar.item1")),1),u("div",Xe,l(e.$t("main.bar.item2")),1),u("div",Ye,[s(F,{class:"el-menu-demo",mode:"horizontal","background-color":"#545c64","text-color":"#fff","active-text-color":"#ffd04b",ellipsis:!1,onSelect:X},{default:o(()=>[s(a,{index:"findNew",class:"menuItem"},{default:o(()=>[c(l(e.$t("main.bar.item3")),1)]),_:1}),s(a,{index:"reqList",class:"menuItem"},{default:o(()=>[c(l(e.$t("main.bar.item4")),1)]),_:1}),s(a,{index:"inviteList",class:"menuItem"},{default:o(()=>[c(l(e.$t("main.bar.item5")),1)]),_:1}),s(a,{index:"statusList",class:"menuItem"},{default:o(()=>[c(l(e.$t("main.bar.item6")),1)]),_:1})]),_:1})])]),_:1}),s(Z,{class:"main-main"},{default:o(()=>[s(ee,null,{default:o(()=>[s(de,{width:"10vw",id:"mainAside"},{default:o(()=>[u("div",Ze,[u("div",et,[s(ae,{isFriend:"",showAll:d(g),param:d(V),onAddPage:O,ref_key:"fnoticeNew",ref:x},null,8,["showAll","param"])]),u("div",tt,[s(ae,{isFriend:!1,showAll:d(C),param:d(N),onAddPage:O,ref_key:"gnoticeNew",ref:B},null,8,["showAll","param"])])])]),_:1}),s(Z,{width:"90vw",class:"mainPart"},{default:o(()=>[s(d($e),{onWSend:Y},{default:o(({Component:z})=>[(m(),y(Le(z),{ref_key:"order",ref:M},null,512))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})])}}},ht=ue(nt,[["__scopeId","data-v-976582f9"]]);export{ht as default};
