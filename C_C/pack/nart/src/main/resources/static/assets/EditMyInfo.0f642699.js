import{u as R}from"./userStore.df57d0cc.js";import{D as M,s as T,c as V,r as v,b as x,d as w,f as z,g as L,j as l,h as r,i as I,k as O,t as C,l as u,H,E as p}from"./index.25c5763d.js";import{I as g}from"./InfoItem.40cb8750.js";import{d as W,u as Z}from"./upload.bc07a7ff.js";import{_ as q}from"./_plugin-vue_export-helper.cdc0426e.js";/* empty css                                                                 */const G={class:"all flex"},J={class:"big center"},K={class:"small center"},Q={class:"el-upload__tip"},X={class:"flex text"},Y={class:"item-div flex item1"},ee={class:"item"},ae={class:"item"},te={class:"item-div flex"},se={class:"item"},le={class:"item"},oe={class:"item-div flex"},ne={class:"item"},re={class:"item"},ce=M({__name:"EditMyInfo",setup(ie){const f=R(),{avatar:y,name:F,email:E,tel:P,birthday:k,address:D}=T(f),{t:n}=V(),m=v(y);v(0);const t=x({uname:F.value,avatar:y.value,email:E.value,phone:P.value,address:D.value,birthday:k.value,oldPwd:"",pwd:""}),_=v();let d=x([]);const o={reg1:/^[a-z0-9_-]{3,16}$/,reg2:/^\d{4}-\d{2}-\d{2}$/,reg4:/^[1-9]\d{2}-\d{3}-\d{4}/,reg6:/^[#.0-9a-zA-Z\s,-]+$/,reg5:/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/,label1:"1",label2:"2",label4:"4",label5:"5",label6:"6"},S=e=>{_.value.clearFiles();const a=e[0];a.uid=H(),_.value.handleStart(a)};function U(e,a){let c=new FileReader;c.readAsDataURL(e.raw),c.onload=i=>{d.push({name:e.raw.name,url:i.target.result})},d.push(e.raw),$()}function B(e){return new Promise((a,c)=>{setTimeout(()=>{e=="https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png"&&a("No need to delete"),e.startsWith("https://s1.ax1x.com")||a("Cannot Delete");let i=e.lastIndexOf("/")+1,s=e.lastIndexOf("."),A=e.substring(i,s);W(A).then(b=>{b.data.success?(p({type:"success",message:n("chatInputBox.deletePicSuccess"),showClose:!0,grouping:!0}),a("Delete Success")):(p({type:"error",message:b.data.msg,showClose:!0,grouping:!0}),a("Delete Fail"))}).catch(b=>{p({type:"error",message:n("chatInputBox.deletePicError"),showClose:!0,grouping:!0}),console.log(b),a("Delete Error")})},500)})}function N(){return new Promise((e,a)=>{setTimeout(()=>{let c=new FormData,i=d;for(let s=0;s<i.length;s++)c.append("file",i[s]);Z(c,1).then(s=>{s.data.success?(m.value=s.data.data,e("Upload New Avatar Success!")):(p({type:"error",message:s.data.msg,showClose:!0,grouping:!0}),d.length=0)}).catch(s=>{p({type:"error",message:n("chatInputBox.uploadPicError"),showClose:!0,grouping:!0}),console.log(s),d.length=0})},500)})}async function $(){await B(m.value),await N(),d.length=0,_.value.clearFiles(),t.avatar=m,f.changeUserInfo(t)}async function h(e,a){switch(e){case o.label1:t.uname=a;break;case o.label2:t.birthday=a;break;case o.label4:t.phone=a;break;case o.label5:t.email=a;break;case o.label6:t.address=a;break}f.changeUserInfo(t)}async function j(e,a){t.oldPwd=e,t.pwd=a,f.changeUserInfo(t)}return(e,a)=>{const c=w("el-image"),i=w("el-button"),s=w("el-upload");return z(),L("div",G,[l("div",J,[r(c,{class:"img",src:m.value,"preview-src-list":[m.value],fit:"cover"},null,8,["src","preview-src-list"]),l("div",K,[r(s,{ref_key:"uploadRef",ref:_,"on-change":U,"on-exceed":S,class:"upload-demo",accept:"image/jpeg,image/png,image/jpg",action:"#","file-list":u(d),limit:1,"auto-upload":!1,"show-file-list":!1},{trigger:I(()=>[r(i,{type:"primary",round:"",class:"",style:{"margin-top":"1vh"}},{default:I(()=>[O(C(e.$t("groupSetting.addAvatar")),1)]),_:1})]),tip:I(()=>[l("div",Q,C(e.$t("buttons.picInfo")),1)]),_:1},8,["file-list"])])]),l("div",X,[l("div",Y,[l("div",ee,[r(g,{label:u(n)("infoItem.userName"),reg:o.reg1,value:t.uname,lb:"1","can-change":"",onChangeFun:h},null,8,["label","reg","value"])]),l("div",ae,[r(g,{label:u(n)("infoItem.birthday"),reg:o.reg2,value:t.birthday,lb:"2","can-change":"",onChangeFun:h},null,8,["label","reg","value"])])]),l("div",te,[l("div",se,[r(g,{label:u(n)("infoItem.password"),"can-change":"","is-pwd":"",onChangePwd:j},null,8,["label"])]),l("div",le,[r(g,{label:u(n)("infoItem.phone"),reg:o.reg4,value:t.phone,lb:"4","can-change":"",onChangeFun:h},null,8,["label","reg","value"])])]),l("div",oe,[l("div",ne,[r(g,{label:u(n)("infoItem.email"),reg:o.reg5,value:t.email,lb:"5","can-change":"",onChangeFun:h},null,8,["label","reg","value"])]),l("div",re,[r(g,{label:u(n)("infoItem.address"),reg:o.reg6,value:t.address,lb:"6","can-change":"",onChangeFun:h},null,8,["label","reg","value"])])])])])}}});const fe=q(ce,[["__scopeId","data-v-eb2bed49"]]);export{fe as default};
